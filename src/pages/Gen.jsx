import {useParams} from "react-router-dom";
import {getPokemonsByGeneration} from "../api/pokemons.js";
import {useEffect, useState} from "react";

import Title from "../components/layout/title.jsx";
import CardPokemon from "../components/card-pokemon.jsx";

function Gen() {
  const {id} = useParams();
  const [pokemons, setPokemons] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  function scrollToTop() {
    window.scrollTo({top: 0, behavior: 'smooth'});
  }


  useEffect(() => {
    const fetchPokemons = async () => {
      setLoading(true);
      setError(null);
      try {
        const data = await getPokemonsByGeneration(id);
        setPokemons(data);
      } catch (error) {
        console.log(error);
        setError("Erreur lors de la récupération des données.");
      } finally {
        setLoading(false);
      }
    };

    fetchPokemons();
  }, [id]);

  if (loading) {
    return (
      <main className="container flex justify-center items-center min-h-[calc(100dvh-144px)]">
        <div className="flex flex-col justify-center items-center">
          <svg xmlns="http://www.w3.org/2000/svg"
               className="w-72 sm:w-96"
               viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M4.463 11.691c-.081-.436-.651-.676-1.217-.368l.146.498l.23.737l.104.335c.423-.272.85-.599.737-1.203zm-.562.67l-.197-.636l-.059-.203a.54.54 0 0 1 .33.033c.053.026.146.084.166.196c.047.25-.037.429-.24.608zm9.108-1.362a.774.774 0 1 0-.963 1.207l1.018-1.153zm-.961.812a.5.5 0 0 1 .618-.707zm7.551.225a.4.4 0 0 1 .013.105c-.01.215-.213.382-.454.37c-.241-.008-.43-.191-.42-.405c.007-.203.187-.362.409-.372a1 1 0 0 0-.132-.017c-.405-.017-.735.27-.748.626c-.017.38.289.692.686.709c.406.015.735-.272.75-.651a.63.63 0 0 0-.103-.365m-12.255.436c0 .216-.197.39-.438.39c-.242 0-.438-.173-.438-.39c0-.202.173-.368.394-.388a1 1 0 0 0-.132-.012c-.404 0-.723.3-.723.656c0 .382.32.68.716.68c.405 0 .723-.298.723-.68a.6.6 0 0 0-.119-.358q.016.046.017.102m14.768-2.185l-.18.739l-.166-.82l-2.218-.487l.016 1.233l.334.075l-.024.223l-.01-.007c-.414-.218-.927-.24-1.41-.058q-.245.092-.45.242l-.335-2.112h-1.475l-.04.244h-1.553l-.177 1.085l-.13-.159a1.99 1.99 0 0 0-1.525-.73l1.318-.709l-.918-1.37l-1.663 1.913l.287.35a2.2 2.2 0 0 0-.674.429L9.696 9.104l-.497.953l.019-.916l-2.226.712l.057 1.196l.379-.098l.056.605c-.433-.193-.954-.19-1.436.014a2 2 0 0 0-.399.229a1.7 1.7 0 0 0-.077-1.058a1.9 1.9 0 0 0-.817-.9a1.96 1.96 0 0 0-.865-.308c-.77-.135-1.696.003-2.606.392a6.3 6.3 0 0 0-.928.483L0 10.634l.215.363l.667 1.127s.204.346.205.345l.361-.177l.05-.023l1.658 3.7l.16.355l.37-.118l.896-.288l.394-.125l-.104-.4l-.476-1.829q.205-.152.383-.321c-.027.219-.013.44.047.652c.124.443.416.793.818.986c.435.21.965.21 1.456.002c.247-.104.467-.257.651-.439l.068.728l1.57-.231l-.002-1.407l3.282 1.62v-1.57a3.3 3.3 0 0 0 1.347-.436l-.138.843l1.77.279l.097-.637l.461.854l.283-.545l.104.895l2.005.352l-.106-.674a1.8 1.8 0 0 0 1.038-.198l-.08.718l1.336.189l.01.547l1.39.438L24 10.745zm-7.839.81l.092-.097l-.112.69l-.289-.262zm-1.177-2.813l.487.661l-1.39.689l-.097-.146zm-9.202 5.091l.555 2.128l-.898.287l-1.841-4.112c-.1.053-.284.14-.455.223L.59 10.775q.4-.254.865-.45c.868-.369 1.697-.48 2.36-.362c.233.027.481.095.7.24c.298.168.525.406.657.711c.32.74-.215 1.807-1.276 2.461zm4.126-.378c-.01.318-.127.634-.321.903a1.8 1.8 0 0 1-.749.605c-.779.33-1.557 0-1.764-.74c-.203-.714.266-1.565 1.02-1.89c.483-.202.966-.155 1.312.08c.213.146.377.364.453.637a1.3 1.3 0 0 1 .049.406zm4.236 1.504l-3.254-1.629l.006 1.707l-.843.115l-.059-.703c.26-.446.355-.972.22-1.454a1.5 1.5 0 0 0-.4-.68l-.121-1.433l-.377.098l-.017-.362l1.352-.404l.083 1.396l.997-1.4l.974.927l-1.362 1.436l1.28.507c.142.27.36.5.634.67c.264.163.568.26.889.291v.918zm-1.69-2.36l-.454-.174l.423-.41q-.03.284.03.584zm3.542.427c-.312.259-.67.427-1.139.54a2 2 0 0 1-.302.051c-.747.073-1.374-.27-1.612-.826a1 1 0 0 1-.069-.209c-.11-.468-.016-.887.215-1.215a1.5 1.5 0 0 1 .235-.261a1.9 1.9 0 0 1 .812-.413c.712-.171 1.339.046 1.723.517l-1.355 1.444a1 1 0 0 0 .345-.033c.323-.079.504-.25.663-.436l.542.486l.164.15a3 3 0 0 1-.222.205m2.877 1.927l-.294-1.954l-.418 1.078l-.625-1.348h-.007l-.246 1.56l-1.041-.18l.146-.87l.116-.114l.338-.348l-.329-.294l.35-2.073h1.05l.262 1.436l.294-1.663h.752l.312 2.026c-.396.451-.59 1.06-.456 1.615a1.48 1.48 0 0 0 .865 1.035l.04.263zm2.595-.637a1.6 1.6 0 0 1-.377.2a1.4 1.4 0 0 1-.773.077a1.15 1.15 0 0 1-.448-.19a1.12 1.12 0 0 1-.43-.655c-.08-.336-.007-.696.174-1.012c.091-.154.207-.298.344-.423c.152-.137.33-.25.527-.325c.459-.172.912-.112 1.23.116a1.08 1.08 0 0 1 .422.633c.098.406-.018.838-.274 1.187a1.8 1.8 0 0 1-.395.392m2.343 1.841l-.77-.229l-.066-2.838l-.388 2.19l-.84-.135l.062-.63c.547-.464.838-1.195.679-1.856a1.46 1.46 0 0 0-.434-.744l.071-.743l-.317-.085l.02-.396l1.448.29l.487 2.308l.499-2.069l1.1.244z"/>
          </svg>
          <span className="loading loading-dots loading-lg"></span>
        </div>
      </main>
    );
  }

  if (error) {
    return (
      <main className="container flex justify-center items-center min-h-[calc(100dvh-144px)]">
        <div className="flex flex-col justify-center items-center">
          <svg xmlns="http://www.w3.org/2000/svg"
               className="w-72 sm:w-96"
               viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M4.463 11.691c-.081-.436-.651-.676-1.217-.368l.146.498l.23.737l.104.335c.423-.272.85-.599.737-1.203zm-.562.67l-.197-.636l-.059-.203a.54.54 0 0 1 .33.033c.053.026.146.084.166.196c.047.25-.037.429-.24.608zm9.108-1.362a.774.774 0 1 0-.963 1.207l1.018-1.153zm-.961.812a.5.5 0 0 1 .618-.707zm7.551.225a.4.4 0 0 1 .013.105c-.01.215-.213.382-.454.37c-.241-.008-.43-.191-.42-.405c.007-.203.187-.362.409-.372a1 1 0 0 0-.132-.017c-.405-.017-.735.27-.748.626c-.017.38.289.692.686.709c.406.015.735-.272.75-.651a.63.63 0 0 0-.103-.365m-12.255.436c0 .216-.197.39-.438.39c-.242 0-.438-.173-.438-.39c0-.202.173-.368.394-.388a1 1 0 0 0-.132-.012c-.404 0-.723.3-.723.656c0 .382.32.68.716.68c.405 0 .723-.298.723-.68a.6.6 0 0 0-.119-.358q.016.046.017.102m14.768-2.185l-.18.739l-.166-.82l-2.218-.487l.016 1.233l.334.075l-.024.223l-.01-.007c-.414-.218-.927-.24-1.41-.058q-.245.092-.45.242l-.335-2.112h-1.475l-.04.244h-1.553l-.177 1.085l-.13-.159a1.99 1.99 0 0 0-1.525-.73l1.318-.709l-.918-1.37l-1.663 1.913l.287.35a2.2 2.2 0 0 0-.674.429L9.696 9.104l-.497.953l.019-.916l-2.226.712l.057 1.196l.379-.098l.056.605c-.433-.193-.954-.19-1.436.014a2 2 0 0 0-.399.229a1.7 1.7 0 0 0-.077-1.058a1.9 1.9 0 0 0-.817-.9a1.96 1.96 0 0 0-.865-.308c-.77-.135-1.696.003-2.606.392a6.3 6.3 0 0 0-.928.483L0 10.634l.215.363l.667 1.127s.204.346.205.345l.361-.177l.05-.023l1.658 3.7l.16.355l.37-.118l.896-.288l.394-.125l-.104-.4l-.476-1.829q.205-.152.383-.321c-.027.219-.013.44.047.652c.124.443.416.793.818.986c.435.21.965.21 1.456.002c.247-.104.467-.257.651-.439l.068.728l1.57-.231l-.002-1.407l3.282 1.62v-1.57a3.3 3.3 0 0 0 1.347-.436l-.138.843l1.77.279l.097-.637l.461.854l.283-.545l.104.895l2.005.352l-.106-.674a1.8 1.8 0 0 0 1.038-.198l-.08.718l1.336.189l.01.547l1.39.438L24 10.745zm-7.839.81l.092-.097l-.112.69l-.289-.262zm-1.177-2.813l.487.661l-1.39.689l-.097-.146zm-9.202 5.091l.555 2.128l-.898.287l-1.841-4.112c-.1.053-.284.14-.455.223L.59 10.775q.4-.254.865-.45c.868-.369 1.697-.48 2.36-.362c.233.027.481.095.7.24c.298.168.525.406.657.711c.32.74-.215 1.807-1.276 2.461zm4.126-.378c-.01.318-.127.634-.321.903a1.8 1.8 0 0 1-.749.605c-.779.33-1.557 0-1.764-.74c-.203-.714.266-1.565 1.02-1.89c.483-.202.966-.155 1.312.08c.213.146.377.364.453.637a1.3 1.3 0 0 1 .049.406zm4.236 1.504l-3.254-1.629l.006 1.707l-.843.115l-.059-.703c.26-.446.355-.972.22-1.454a1.5 1.5 0 0 0-.4-.68l-.121-1.433l-.377.098l-.017-.362l1.352-.404l.083 1.396l.997-1.4l.974.927l-1.362 1.436l1.28.507c.142.27.36.5.634.67c.264.163.568.26.889.291v.918zm-1.69-2.36l-.454-.174l.423-.41q-.03.284.03.584zm3.542.427c-.312.259-.67.427-1.139.54a2 2 0 0 1-.302.051c-.747.073-1.374-.27-1.612-.826a1 1 0 0 1-.069-.209c-.11-.468-.016-.887.215-1.215a1.5 1.5 0 0 1 .235-.261a1.9 1.9 0 0 1 .812-.413c.712-.171 1.339.046 1.723.517l-1.355 1.444a1 1 0 0 0 .345-.033c.323-.079.504-.25.663-.436l.542.486l.164.15a3 3 0 0 1-.222.205m2.877 1.927l-.294-1.954l-.418 1.078l-.625-1.348h-.007l-.246 1.56l-1.041-.18l.146-.87l.116-.114l.338-.348l-.329-.294l.35-2.073h1.05l.262 1.436l.294-1.663h.752l.312 2.026c-.396.451-.59 1.06-.456 1.615a1.48 1.48 0 0 0 .865 1.035l.04.263zm2.595-.637a1.6 1.6 0 0 1-.377.2a1.4 1.4 0 0 1-.773.077a1.15 1.15 0 0 1-.448-.19a1.12 1.12 0 0 1-.43-.655c-.08-.336-.007-.696.174-1.012c.091-.154.207-.298.344-.423c.152-.137.33-.25.527-.325c.459-.172.912-.112 1.23.116a1.08 1.08 0 0 1 .422.633c.098.406-.018.838-.274 1.187a1.8 1.8 0 0 1-.395.392m2.343 1.841l-.77-.229l-.066-2.838l-.388 2.19l-.84-.135l.062-.63c.547-.464.838-1.195.679-1.856a1.46 1.46 0 0 0-.434-.744l.071-.743l-.317-.085l.02-.396l1.448.29l.487 2.308l.499-2.069l1.1.244z"/>
          </svg>
          <p className="text-center text-lg">Veuillez nous excuser mais nous ne parvenons pas charger les pokémons</p>
        </div>
      </main>
    )

  }

  return (
    <main className="py-20 container">
      <Title content={id + " " + (parseInt(id) === 1 ? "ère" : "ème") + " Génération de Pokémons"} size={"small"}/>

      <div className="grid grid-cols-1 sm:grid-cols-2 px-8 lg:px-0 lg:grid-cols-4 gap-x-24 gap-y-48 py-52">
        {pokemons.length > 0 ? (
          pokemons.map((pokemon) => (
            <CardPokemon key={pokemon.id} pokemon={pokemon}/>
          ))
        ) : (
          <h2>Aucun Pokémon trouvé pour cette génération.</h2>
        )}
      </div>
      <span className="fixed bottom-10 right-4 bg-transparent rounded-full p-2 cursor-pointer shadow-md"
            onClick={scrollToTop}>
        <svg xmlns="http://www.w3.org/2000/svg"
             className="size-8 text-gradientR"
             viewBox="0 0 24 24">
          <path fill="currentColor"
                d="M3 19h18a1.002 1.002 0 0 0 .823-1.569l-9-13c-.373-.539-1.271-.539-1.645 0l-9 13A.999.999 0 0 0 3 19"/>
        </svg>
      </span>
    </main>
  );
}

export default Gen;
